<?xml version="1.0" encoding="UTF-8"?>
<context>
    <epic>
        <id>2</id>
        <title>Configuration Management</title>
        <description>Develop a comprehensive system for user configuration, YAML handling, and file operations.</description>
    </epic>
    <story>
        <id>2.1</id>
        <title>YAML Handler with Ruamel</title>
        <description>Create a centralized, comment-preserving YAML handler utility using ruamel.yaml.</description>
        <status>drafted</status>
    </story>
    <artifacts>
        <artifact>
            <type>story_specification</type>
            <path>docs/sprint-artifacts/2-1-yaml-handler-with-ruamel.md</path>
            <description>The primary specification document for the YAMLHandler utility.</description>
        </artifact>
        <artifact>
            <type>implementation</type>
            <path>capsule/utils/yaml_handler.py</path>
            <description>The Python file where the YAMLHandler class will be implemented.</description>
        </artifact>
        <artifact>
            <type>tests</type>
            <path>tests/test_utils/test_yaml_handler.py</path>
            <description>The unit test file for the YAMLHandler.</description>
        </artifact>
        <artifact>
            <type>exceptions</type>
            <path>capsule/utils/exceptions.py</path>
            <description>Location for custom exceptions, including YAMLFileError.</description>
        </artifact>
        <artifact>
            <type>pattern_reference</type>
            <path>capsule/models/config.py</path>
            <description>Recent example of direct ruamel.yaml usage that this story will centralize.</description>
        </artifact>
    </artifacts>
    <dependencies>
        <dependency>
            <type>external_library</type>
            <name>ruamel.yaml</name>
            <version>0.18.6</version>
            <reason>The core library for all YAML operations, chosen for its ability to preserve comments and formatting.</reason>
        </dependency>
    </dependencies>
    <constraints>
        <constraint>
            <type>technical</type>
            <description>The handler must use static methods, as it should not maintain any internal state.</description>
        </constraint>
        <constraint>
            <type>technical</type>
            <description>All file I/O must be performed with UTF-8 encoding.</description>
        </constraint>
        <constraint>
            <type>quality</type>
            <description>The code must be formatted with Black and pass Mypy strict type checking.</description>
        </constraint>
        <constraint>
            <type>quality</type>
            <description>Unit tests must achieve a minimum of 95% code coverage.</description>
        </constraint>
    </constraints>
    <interfaces>
        <interface>
            <type>class</type>
            <name>YAMLHandler</name>
            <signature>class YAMLHandler:</signature>
            <description>A utility class for handling YAML file operations.</description>
        </interface>
        <interface>
            <type>static_method</type>
            <name>read</name>
            <signature>@staticmethod def read(path: Path) -> Any:</signature>
            <description>Reads and parses a YAML file, returning its content.</description>
        </interface>
        <interface>
            <type>static_method</type>
            <name>write</name>
            <signature>@staticmethod def write(path: Path, data: Any) -> None:</signature>
            <description>Writes given data to a YAML file, preserving comments if the data object supports it.</description>
        </interface>
        <interface>
            <type>exception</type>
            <name>YAMLFileError</name>
            <signature>class YAMLFileError(Exception):</signature>
            <description>Custom exception raised for errors during YAML file processing.</description>
        </interface>
    </interfaces>
    <test_ideas>
        <idea>Test reading a simple YAML file and verify the returned data structure.</idea>
        <idea>Test writing a dictionary to a YAML file and reading it back.</idea>
        <idea>Test that a YAML file with comments, when read and then written to a new file, retains its comments.</idea>
        <idea>Test that a FileNotFoundError is raised (as a YAMLFileError) when trying to read a non-existent file.</idea>
        <idea>Test that a parsing error is raised (as a YAMLFileError) when trying to read a malformed YAML file.</idea>
        <idea>Test writing to a path where the parent directory does not exist (should it fail or create it? Decide and test).</idea>
    </test_ideas>
</context>
