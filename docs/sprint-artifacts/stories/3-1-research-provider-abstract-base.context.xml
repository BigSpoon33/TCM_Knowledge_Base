<story-context id="{bmad_folder}/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>3</epicId>
    <storyId>3.1</storyId>
    <title>Research Provider Abstract Base</title>
    <status>drafted</status>
    <generatedAt>2025-11-16</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>/home/shuma/Documents/AI_Suite/Obsidian_Capsule_Delivery/docs/sprint-artifacts/3-1-research-provider-abstract-base.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>a developer</asA>
    <iWant>a `ResearchProvider` abstract base class (ABC) that defines a common interface for all research providers</iWant>
    <soThat>new providers (like Gemini, Perplexity, etc.) can be added in a pluggable way without changing the core research logic</soThat>
    <tasks>
      <task id="3.1" title="Implement Abstract Base Class">
        <subtask id="3.1.1">Create the file `capsule/core/researcher.py`.</subtask>
        <subtask id="3.1.2">Implement the `ResearchProvider` abstract base class using Python's `abc` module.</subtask>
        <subtask id="3.1.3">Define the `research` abstract method with the specified signature.</subtask>
      </task>
      <task id="3.2" title="Develop Unit Tests">
        <subtask id="3.2.1">Create the test file `tests/test_core/test_researcher.py`.</subtask>
        <subtask id="3.2.2">Write a test that attempts to instantiate `ResearchProvider` directly and asserts that a `TypeError` is raised.</subtask>
        <subtask id="3.2.3">Write a test with a mock subclass that fails to implement the `research` method and assert that a `TypeError` is raised upon instantiation.</subtask>
        <subtask id="3.2.4">Write a test with a mock subclass that correctly implements the `research` method and assert that it can be instantiated successfully.</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
      <criterion id="1">**Abstract Base Class:** A `ResearchProvider` abstract base class is created in `capsule/core/researcher.py`.</criterion>
      <criterion id="2">**Interface Definition:** The `ResearchProvider` class defines an abstract method `research(self, topic: str, max_sources: int = 10) -> Dict`.</criterion>
      <criterion id="3">**Data Structure:** The `research` method's return type is a dictionary containing `content`, `citations`, and `metadata`.</criterion>
      <criterion id="4">**Type Hinting:** All methods and arguments are fully type-hinted.</criterion>
      <criterion id="5">**Unit Tests:** Basic unit tests are created in `tests/test_core/test_researcher.py` to ensure the ABC cannot be instantiated and that subclasses must implement the `research` method.</criterion>
    </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document</title>
        <section>Deep Research Provider Architecture</section>
        <snippet>
**Provider Interface:**
```python
class ResearchProvider(ABC):
    """Abstract base for research providers"""
    
    @abstractmethod
    def research(self, topic: str, max_sources: int = 10) -> Dict:
        """Returns: {content: str, citations: List[Citation], metadata: Dict}"""
        pass
```
        </snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>capsule/core/researcher.py</path>
        <kind>module</kind>
        <symbol>ResearchProvider</symbol>
        <lines></lines>
        <reason>This file needs to be created to house the new abstract base class.</reason>
      </artifact>
      <artifact>
        <path>tests/test_core/test_researcher.py</path>
        <kind>test</kind>
        <symbol></symbol>
        <lines></lines>
        <reason>This test file needs to be created to provide comprehensive testing for the new abstract base class.</reason>
      </artifact>
    </code>
<dependencies/>
  <constraints>
      <constraint>The `ResearchProvider` class must be an abstract base class.</constraint>
      <constraint>The `research` method must be an abstract method.</constraint>
    </constraints>
  <interfaces/>
  <tests>
      <standards>The project uses the `pytest` framework. Tests for core logic are located in `tests/test_core/`.</standards>
      <locations>
        <location>tests/test_core/test_researcher.py</location>
      </locations>
      <ideas>
        <idea for="1">Test that `ResearchProvider` cannot be instantiated directly.</idea>
        <idea for="2">Test that a subclass of `ResearchProvider` that does not implement the `research` method cannot be instantiated.</idea>
        <idea for="3">Test that a subclass of `ResearchProvider` that does implement the `research` method can be instantiated.</idea>
      </ideas>
    </tests>
</story-context>
